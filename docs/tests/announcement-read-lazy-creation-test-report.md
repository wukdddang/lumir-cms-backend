# AnnouncementRead Lazy Creation ν¨ν„΄ ν…μ¤νΈ κ²€μ¦ μ™„λ£

## β… κ²€μ¦ μ™„λ£

κ³µμ§€μ‚¬ν•­ μ½μ ν‘μ‹(AnnouncementRead)μ **Lazy Creation ν¨ν„΄**μ΄ μ •μƒμ μΌλ΅ λ™μ‘ν•λ” κ²ƒμ„ ν…μ¤νΈλ΅ κ²€μ¦ν–μµλ‹λ‹¤.

---

## π“‹ μ‘μ„±ν• ν…μ¤νΈ

### 1. μ λ‹› ν…μ¤νΈ (Unit Test)
**νμΌ**: `test/domain/core/announcement/announcement.service.spec.ts`

#### ν…μ¤νΈ μΌ€μ΄μ¤ (8κ°)
β… **μ§μ›μ΄ μ²μ κ³µμ§€μ‚¬ν•­μ„ μ½μ„ λ• AnnouncementRead λ μ½”λ“λ¥Ό μƒμ„±ν•΄μ•Ό ν•λ‹¤ (Lazy Creation)**
- μ½μ λ μ½”λ“κ°€ μ—†λ” μƒνƒμ—μ„ μ½μ ν‘μ‹ β†’ μƒ λ μ½”λ“ μƒμ„± ν™•μΈ
- `create()`, `save()` νΈμ¶ κ²€μ¦

β… **μ΄λ―Έ μ½μ€ κ³µμ§€μ‚¬ν•­μ€ μ¤‘λ³µ λ μ½”λ“λ¥Ό μƒμ„±ν•μ§€ μ•κ³  κΈ°μ΅΄ λ μ½”λ“λ¥Ό λ°ν™ν•΄μ•Ό ν•λ‹¤**
- μ΄λ―Έ μ½μ λ μ½”λ“κ°€ μλ” κ²½μ° β†’ κΈ°μ΅΄ λ μ½”λ“ λ°ν™
- `create()`, `save()` νΈμ¶ μ• λ¨ κ²€μ¦

β… **μ΅΄μ¬ν•μ§€ μ•λ” κ³µμ§€μ‚¬ν•­μ— λ€ν•΄ μ½μ ν‘μ‹ μ‹ NotFoundExceptionμ΄ λ°μƒν•΄μ•Ό ν•λ‹¤**
- κ³µμ§€μ‚¬ν•­ μ—†μ β†’ NotFoundException λ°μƒ ν™•μΈ

β… **μ—¬λ¬ μ§μ›μ΄ κ°™μ€ κ³µμ§€μ‚¬ν•­μ„ μ½μ„ λ• κ°κ°μ AnnouncementRead λ μ½”λ“κ°€ μƒμ„±λμ–΄μ•Ό ν•λ‹¤**
- 2λ…μ μ§μ›μ΄ κ°™μ€ κ³µμ§€μ‚¬ν•­ μ½μ β†’ κ°κ° λ μ½”λ“ μƒμ„± ν™•μΈ

β… **μ½μ λ μ½”λ“κ°€ μμΌλ©΄ trueλ¥Ό λ°ν™ν•΄μ•Ό ν•λ‹¤**
- `μ½μ_μ—¬λ¶€λ¥Ό_ν™•μΈν•λ‹¤()` β†’ `true` λ°ν™

β… **μ½μ λ μ½”λ“κ°€ μ—†μΌλ©΄ falseλ¥Ό λ°ν™ν•΄μ•Ό ν•λ‹¤ (Lazy Creation - λ μ½”λ“ μ—†μ)**
- `μ½μ_μ—¬λ¶€λ¥Ό_ν™•μΈν•λ‹¤()` β†’ `false` λ°ν™

β… **κ³µμ§€μ‚¬ν•­μ„ μ½μ€ μ‚¬λ μλ¥Ό λ°ν™ν•΄μ•Ό ν•λ‹¤**
- `μ½μ€_μ‚¬λ_μλ¥Ό_μ΅°νν•λ‹¤()` β†’ 5λ… λ°ν™

β… **μ•„λ¬΄λ„ μ½μ§€ μ•μ€ κ³µμ§€μ‚¬ν•­μ€ 0μ„ λ°ν™ν•΄μ•Ό ν•λ‹¤**
- `μ½μ€_μ‚¬λ_μλ¥Ό_μ΅°νν•λ‹¤()` β†’ 0 λ°ν™

### 2. E2E ν…μ¤νΈ (Integration Test)
**νμΌ**: `test/interface/admin/announcement/announcement-read-lazy-creation.e2e-spec.ts`

#### ν…μ¤νΈ μΌ€μ΄μ¤ (8κ°)
β… **μ§μ›μ΄ κ³µμ§€μ‚¬ν•­μ„ μ²μ μ½μ„ λ• AnnouncementRead λ μ½”λ“κ°€ μƒμ„±λμ–΄μ•Ό ν•λ‹¤**
- κ³µμ§€μ‚¬ν•­ μƒμ„± β†’ μ§μ›μ΄ μ½μ β†’ DBμ— λ μ½”λ“ μƒμ„± ν™•μΈ

β… **κ³µμ§€μ‚¬ν•­ μƒμ„± μ‹μ—λ” AnnouncementRead λ μ½”λ“κ°€ μƒμ„±λμ§€ μ•μ•„μ•Ό ν•λ‹¤ (Lazy Creation)**
- κ³µμ§€μ‚¬ν•­ μƒμ„±λ§ β†’ μ½μ λ μ½”λ“ 0κ° ν™•μΈ

β… **μ—¬λ¬ μ§μ›μ΄ κ°™μ€ κ³µμ§€μ‚¬ν•­μ„ μ½μ„ λ• κ°κ°μ λ μ½”λ“κ°€ μƒμ„±λμ–΄μ•Ό ν•λ‹¤**
- 3λ…μ μ§μ›μ΄ κ°™μ€ κ³µμ§€μ‚¬ν•­ μ½μ β†’ 3κ°μ λ μ½”λ“ ν™•μΈ

β… **ν• μ§μ›μ΄ κ°™μ€ κ³µμ§€μ‚¬ν•­μ„ μ—¬λ¬ λ² μ½μ–΄λ„ λ μ½”λ“λ” 1κ°λ§ μμ–΄μ•Ό ν•λ‹¤ (μ¤‘λ³µ λ°©μ§€)**
- κ°™μ€ μ§μ›μ΄ 2λ² μ½μ μ‹λ„ β†’ λ μ½”λ“ 1κ°λ§ μ μ§€

β… **κ³µμ§€μ‚¬ν•­ μ‚­μ  ν›„μ—λ„ AnnouncementRead λ μ½”λ“λ” μ μ§€λλ‹¤ (μ°Έμ΅° λ¬΄κ²°μ„±)**
- κ³µμ§€μ‚¬ν•­ Soft Delete β†’ μ½μ λ μ½”λ“λ” μ μ§€ (μ΄λ ¥ μ¶”μ  λ©μ )

β… **μ½μ λ μ½”λ“κ°€ μ—†λ” μ§μ›μ€ λ―Έμ—΄λμλ΅ κ°„μ£Όλμ–΄μ•Ό ν•λ‹¤**
- 3λ…λ§ μ½μ β†’ λ‚λ¨Έμ§€λ” λ μ½”λ“ μ—†μ ν™•μΈ

β… **μ½μ λ μ½”λ“μ— readAt νƒ€μ„μ¤νƒ¬ν”„κ°€ μ €μ¥λμ–΄μ•Ό ν•λ‹¤**
- μ½μ€ μ‹κ° κΈ°λ΅ ν™•μΈ

β… **(announcementId, employeeId) μ΅°ν•©μ΄ μ λ‹ν¬ν•΄μ•Ό ν•λ‹¤**
- κ°™μ€ μ΅°ν•©μΌλ΅ λ‘ λ² μ €μ¥ μ‹λ„ β†’ μ—λ¬ λ°μƒ ν™•μΈ

---

## π― κ²€μ¦λ Lazy Creation ν¨ν„΄ νΉμ§•

### 1. **λ μ½”λ“ μƒμ„± μ‹μ **
- β κ³µμ§€μ‚¬ν•­ μƒμ„± μ‹: **λ μ½”λ“ μƒμ„± μ• λ¨**
- β… μ§μ›μ΄ μ½μ„ λ•: **λ μ½”λ“ μƒμ„±λ¨** (Lazy Creation)

### 2. **μ¤‘λ³µ λ°©μ§€**
- Unique μ μ•½: `(announcementId, employeeId)`
- κ°™μ€ μ§μ›μ΄ μ—¬λ¬ λ² μ½μ–΄λ„ **λ μ½”λ“ 1κ°λ§** μ μ§€

### 3. **λ―Έμ—΄λμ μ΅°ν**
- λ μ½”λ“ μ—†μ = λ―Έμ—΄λμ
- `NOT IN` λλ” `LEFT JOIN ... WHERE read.id IS NULL`λ΅ μ΅°ν

### 4. **μ΄λ ¥ μ¶”μ **
- κ³µμ§€μ‚¬ν•­ μ‚­μ  ν›„μ—λ„ μ½μ λ μ½”λ“ μ μ§€
- `readAt` νƒ€μ„μ¤νƒ¬ν”„λ΅ μ½μ€ μ‹κ° μ¶”μ 

### 5. **μ¤ν† λ¦¬μ§€ ν¨μ¨μ„±**
- μ½μ§€ μ•μ€ μ§μ›μ€ λ μ½”λ“ μ—†μ β†’ **μ¤ν† λ¦¬μ§€ μ μ•½**
- μ½μ€ μ§μ›λ§ λ μ½”λ“ μƒμ„± β†’ **ν¨μ¨μ μΈ λ°μ΄ν„° κ΄€λ¦¬**

---

## π“ ν…μ¤νΈ κ²°κ³Ό

### μ λ‹› ν…μ¤νΈ
```bash
Test Suites: 1 passed, 1 total
Tests:       8 passed, 8 total
```

### E2E ν…μ¤νΈ
```bash
Test Suites: 1 passed, 1 total
Tests:       8 passed, 8 total
```

**μ΄ 16κ° ν…μ¤νΈ λ¨λ‘ ν†µκ³Ό** β…

---

## π” μ£Όμ” κ²€μ¦ μ‚¬ν•­

### β… Lazy Creation ν¨ν„΄ λ™μ‘ ν™•μΈ
1. κ³µμ§€μ‚¬ν•­ μƒμ„± μ‹ μ½μ λ μ½”λ“ μƒμ„± μ• λ¨
2. μ§μ›μ΄ μ½μ„ λ•λ§ λ μ½”λ“ μƒμ„±
3. μ¤‘λ³µ λ°©μ§€ (Unique μ μ•½)
4. λ―Έμ—΄λμλ” λ μ½”λ“ μ—†μ

### β… λΉ„μ¦λ‹μ¤ λ΅μ§ κ²€μ¦
1. μ΅΄μ¬ν•μ§€ μ•λ” κ³µμ§€μ‚¬ν•­ β†’ NotFoundException
2. μ΄λ―Έ μ½μ€ κ³µμ§€μ‚¬ν•­ β†’ κΈ°μ΅΄ λ μ½”λ“ λ°ν™
3. μ—¬λ¬ μ§μ› β†’ κ°κ° λ μ½”λ“ μƒμ„±
4. μ½μ μ—¬λ¶€ ν™•μΈ κΈ°λ¥
5. μ½μ€ μ‚¬λ μ μ΅°ν κΈ°λ¥

### β… λ°μ΄ν„° λ¬΄κ²°μ„± κ²€μ¦
1. Unique μ μ•½ μ΅°κ±΄ λ™μ‘
2. μ½μ€ μ‹κ°(readAt) νƒ€μ„μ¤νƒ¬ν”„ μ €μ¥
3. κ³µμ§€μ‚¬ν•­ μ‚­μ  ν›„ μ½μ λ μ½”λ“ μ μ§€ (μ΄λ ¥ μ¶”μ )

---

## π“ κ΄€λ ¨ νμΌ

### μ„λΉ„μ¤ λ΅μ§
- `src/domain/core/announcement/announcement.service.ts`
  - `κ³µμ§€μ‚¬ν•­_μ½μ_ν‘μ‹λ¥Ό_ν•λ‹¤()`: Lazy Creation κµ¬ν„
  - `μ½μ_μ—¬λ¶€λ¥Ό_ν™•μΈν•λ‹¤()`: μ½μ μ—¬λ¶€ ν™•μΈ
  - `μ½μ€_μ‚¬λ_μλ¥Ό_μ΅°νν•λ‹¤()`: μ½μ€ μ‚¬λ μ μ΅°ν

### μ—”ν‹°ν‹°
- `src/domain/core/announcement/announcement-read.entity.ts`
  - UK: `(announcementId, employeeId)`
  - CASCADE: `onDelete: 'CASCADE'`

### ν…μ¤νΈ νμΌ
- `test/domain/core/announcement/announcement.service.spec.ts` (μ λ‹› ν…μ¤νΈ)
- `test/interface/admin/announcement/announcement-read-lazy-creation.e2e-spec.ts` (E2E ν…μ¤νΈ)

---

## π’΅ μ¶”κ°€ κ°μ„  μ μ•

### 1. API μ—”λ“ν¬μΈνΈ μ¶”κ°€ κ³ λ ¤
ν„μ¬λ” μ €μ¥μ†μ— μ§μ ‘ μ ‘κ·Όν•μ—¬ ν…μ¤νΈν–μ§€λ§, μ‹¤μ  ν”„λ΅λ•μ…μ—μ„λ” API μ—”λ“ν¬μΈνΈλ¥Ό ν†µν•΄ μ½μ ν‘μ‹λ¥Ό ν•  μ μμµλ‹λ‹¤:

```typescript
// μμ‹: μ½μ ν‘μ‹ API
POST /api/announcements/:id/read
Authorization: Bearer {token}

// μ‘λ‹µ
{
  "id": "read-uuid",
  "announcementId": "announcement-uuid",
  "employeeId": "employee-uuid",
  "readAt": "2024-01-15T10:30:00Z"
}
```

### 2. μ½μ ν†µκ³„ API κ³ λ ¤
```typescript
// μμ‹: μ½μ ν†µκ³„ API
GET /api/admin/announcements/:id/read-stats

// μ‘λ‹µ
{
  "totalEmployees": 100,
  "readCount": 75,
  "unreadCount": 25,
  "readRate": 75.0
}
```

---

## β… κ²°λ΅ 

**Lazy Creation ν¨ν„΄μ΄ μ •μƒμ μΌλ΅ λ™μ‘**ν•λ” κ²ƒμ„ ν™•μΈν–μµλ‹λ‹¤:

1. β… μ§μ›μ΄ κ³µμ§€μ‚¬ν•­μ„ μ½μ„ λ•λ§ AnnouncementRead λ μ½”λ“ μƒμ„±
2. β… μ¤‘λ³µ λ°©μ§€ (Unique μ μ•½)
3. β… λ―Έμ—΄λμλ” λ μ½”λ“ μ—†μ (μ¤ν† λ¦¬μ§€ ν¨μ¨μ„±)
4. β… μ½μ€ μ‹κ° μ¶”μ  (readAt νƒ€μ„μ¤νƒ¬ν”„)
5. β… μ΄λ ¥ μ¶”μ  (κ³µμ§€μ‚¬ν•­ μ‚­μ  ν›„μ—λ„ λ μ½”λ“ μ μ§€)

**μ΄ 16κ° ν…μ¤νΈ (μ λ‹› 8κ° + E2E 8κ°) λ¨λ‘ ν†µκ³Ό** π‰
